(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-user-address-save-user-address-save"],{"27c4":function(a,t,e){"use strict";e("7a82");var i=e("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(e("53ca"));e("d3b7"),e("159b"),e("14d9");var n=getApp(),l=n.globalData.get_static_url("common"),o={data:function(){return{common_static_url:l,params:null,data_list_loding_status:1,data_list_loding_msg:"",editor_path_type:"",address_data:{},province_list:[],city_list:[],county_list:[],province_id:null,city_id:null,county_id:null,idcard_images_data:{},default_province:"请选择省",default_city:"请选择市",default_county:"请选择区/县",province_value:null,city_value:null,county_value:null,user_location_cache_key:n.globalData.data.cache_userlocation_key,user_location:null,address_discern_value:"",form_submit_disabled_status:!1,home_user_address_map_status:0,home_user_address_idcard_status:0,is_user_address_discern:0,is_user_address_location_discern:0,is_user_address_forbid_choice_region:0}},components:{},props:{},onLoad:function(a){this.setData({params:a})},onReady:function(){uni.setNavigationBarTitle({title:"地址"+(null==(this.params.id||null)?"添加":"编辑")}),this.init_config(),this.user_location_remove(),this.init()},onShow:function(){this.user_location_init(),n.globalData.page_share_handle()},methods:{init_config:function(a){1==(a||!1)?this.setData({home_user_address_map_status:n.globalData.get_config("config.home_user_address_map_status"),home_user_address_idcard_status:n.globalData.get_config("config.home_user_address_idcard_status"),is_user_address_discern:n.globalData.get_config("plugins_base.intellectstools.data.is_user_address_discern",0),is_user_address_location_discern:n.globalData.get_config("plugins_base.intellectstools.data.is_user_address_location_discern",0),is_user_address_forbid_choice_region:n.globalData.get_config("plugins_base.intellectstools.data.is_user_address_forbid_choice_region",0)}):n.globalData.is_config(this,"init_config")},init:function(){var a=n.globalData.get_user_info(this,"init");if(0!=a){if(n.globalData.user_is_need_login(a))return uni.redirectTo({url:"/pages/login/login?event_callback=init"}),this.setData({data_list_loding_status:2,data_list_loding_msg:"请先绑定手机号码"}),!1;this.get_province_list(),this.get_data()}else this.setData({data_list_loding_status:2,data_list_loding_msg:"请先授权用户信息"})},get_data:function(){var a=this;uni.request({url:n.globalData.get_request_url("detail","useraddress"),method:"POST",data:this.params,dataType:"json",success:function(t){if(0==t.data.code){var e=t.data.data||null,i=e.data||null,s={idcard_front:null==i?"":i.idcard_front||"",idcard_back:null==i?"":i.idcard_back||""};if(a.setData({address_data:i||{},idcard_images_data:s,editor_path_type:e.editor_path_type||""}),null!=i){a.setData({province_id:i.province||null,city_id:i.city||null,county_id:i.county||null});var l=i.lng||0,o=i.lat||0;0!=l&&0!=o&&a.setData({user_location:{lng:l,lat:o,address:i.address||""}})}a.region_data_fill_handle()}else n.globalData.is_login_check(t.data)&&n.globalData.showToast(t.data.msg)},fail:function(){n.globalData.showToast("省份信息失败")}})},region_data_fill_handle:function(){this.get_city_list(!0),this.get_county_list(!0)},init_region_value:function(){this.setData({province_value:this.get_region_value("province_list","province_id"),city_value:this.get_region_value("city_list","city_id"),county_value:this.get_region_value("county_list","county_id")})},get_region_value:function(a,t){var e=this[a],i=this[t],s=null;return e.forEach((function(a,t){if(a.id==i)return s=t,!1})),s},get_province_list:function(){var a=this;uni.request({url:n.globalData.get_request_url("index","region"),method:"POST",data:{},dataType:"json",success:function(t){if(0==t.data.code){var e=t.data.data;a.setData({province_list:e})}else n.globalData.showToast(t.data.msg)},fail:function(){n.globalData.showToast("省份获取失败")}})},get_city_list:function(){var a=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.province_id&&uni.request({url:n.globalData.get_request_url("index","region"),method:"POST",data:{pid:this.province_id},dataType:"json",success:function(e){if(0==e.data.code){var i=e.data.data;a.setData({city_list:i}),t&&a.init_region_value()}else n.globalData.showToast(e.data.msg)},fail:function(){n.globalData.showToast("城市获取失败")}})},get_county_list:function(){var a=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.city_id&&uni.request({url:n.globalData.get_request_url("index","region"),method:"POST",data:{pid:this.city_id},dataType:"json",success:function(e){if(0==e.data.code){var i=e.data.data;a.setData({county_list:i}),t&&a.init_region_value()}else n.globalData.showToast(e.data.msg)},fail:function(){n.globalData.showToast("区/县获取失败")}})},select_province_event:function(a){var t=a.detail.value||0;if(t>=0){var e=this.province_list[t];this.setData({province_value:t,province_id:e.id,city_value:null,county_value:null,city_id:null,county_id:null}),this.get_city_list()}},select_city_event:function(a){var t=a.detail.value||0;if(t>=0){var e=this.city_list[t];this.setData({city_value:t,city_id:e.id,county_value:null,county_id:null}),this.get_county_list()}},select_county_event:function(a){var t=a.detail.value||0;if(t>=0){var e=this.county_list[t];this.setData({county_value:t,county_id:e.id})}},region_select_error_event:function(a){var t=a.currentTarget.dataset.value||null;null!=t&&n.globalData.showToast(t)},choose_location_event:function(a){uni.navigateTo({url:"/pages/common/open-setting-location/open-setting-location"})},user_location_remove:function(){uni.removeStorage({key:this.user_location_cache_key})},user_location_init:function(){var a=uni.getStorageSync(this.user_location_cache_key)||null,t=null;null!=a&&(t={name:a.name||null,address:a.address||null,lat:a.latitude||null,lng:a.longitude||null}),this.setData({user_location:t}),null!=a&&1==this.is_user_address_location_discern&&this.address_discern_handle(a,0,1)},file_upload_event:function(a){var t=a.currentTarget.dataset.value||null;if(null==t)return n.globalData.showToast("表单名称类型有误"),!1;var e=this;uni.chooseImage({count:1,success:function(a){var i=a.tempFilePaths.length;e.upload_one_by_one(a.tempFilePaths,0,0,0,i,t)}})},upload_one_by_one:function(a,t,e,i,l,o){var d=this;uni.uploadFile({url:n.globalData.get_request_url("index","ueditor"),filePath:a[i],name:"upfile",formData:{action:"uploadimage",path_type:d.editor_path_type},success:function(a){if(t++,200==a.statusCode){var e="object"==(0,s.default)(a.data)?a.data:JSON.parse(a.data);if(0==e.code&&null!=(e.data.url||null)){var i=d.idcard_images_data||{};i[o]=e.data.url,d.setData({idcard_images_data:i})}else n.globalData.showToast(e.msg)}},fail:function(a){e++},complete:function(s){i++,i>=l||d.upload_one_by_one(a,t,e,i,l,o)}})},upload_delete_event:function(a){var t=a.currentTarget.dataset.value||null;if(null==t)return n.globalData.showToast("表单名称类型有误"),!1;var e=this;uni.showModal({title:"温馨提示",content:"删除后不可恢复、继续吗？",success:function(a){if(a.confirm){var i=e.idcard_images_data||{};i[t]="",e.setData({idcard_images_data:i})}}})},default_ads_change_event:function(a){var t=this.address_data;t["is_default"]=1==(t.is_default||0)?0:1,this.setData({address_data:t})},address_discern_value_event:function(a){this.setData({address_discern_value:a.detail.value})},address_discern_submit_event:function(a){if(null==(this.address_discern_value||null))return n.globalData.showToast("请先输入地址信息"),!1;this.address_discern_handle({address:this.address_discern_value},1,0)},address_discern_handle:function(a){var t=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;a["is_user"]=e,uni.showLoading({title:"处理中...",mask:!0}),uni.request({url:n.globalData.get_request_url("address","index","intellectstools"),method:"POST",data:a,dataType:"json",success:function(a){if(uni.hideLoading(),0==a.data.code){var e=t.address_data||{},s=a.data.data,l={province_id:s.province||null,city_id:s.city||null,county_id:s.county||null},o=["province","city","county","province_name","city_name","county_name","address","name","tel"];for(var d in o)null!=(s[o[d]]||null)&&(e[o[d]]=s[o[d]]);0==i?(l["user_location"]=null,e["lng"]="",e["lat"]="",t.user_location_remove()):e["alias"]=t.user_location.name,l["address_data"]=e,t.setData(l),t.region_data_fill_handle()}else n.globalData.is_login_check(a.data)?n.globalData.showToast(a.data.msg):n.globalData.showToast("提交失败，请重试！")},fail:function(){uni.hideLoading(),n.globalData.showToast("服务器请求出错")}})},form_submit:function(a){var t=this,e=a.detail.value;e["params"]=this.params;var i=[{fields:"name",msg:"请填写联系人"},{fields:"tel",msg:"请填写联系电话"},{fields:"province",msg:"请选择省份"},{fields:"city",msg:"请选择城市"},{fields:"county",msg:"请选择区县"},{fields:"address",msg:"请填写详细地址"}];1==this.home_user_address_map_status&&(i.push({fields:"lng",msg:"请选择地理位置"}),i.push({fields:"lat",msg:"请选择地理位置"})),1==this.home_user_address_idcard_status&&(i.push({fields:"idcard_name",msg:"请填写身份证姓名"}),i.push({fields:"idcard_number",msg:"请填写身份证号码"}),i.push({fields:"idcard_front",msg:"请上传身份证正面照片"}),i.push({fields:"idcard_back",msg:"请上传身份证背面照片"}),e["idcard_front"]=this.idcard_images_data.idcard_front||"",e["idcard_back"]=this.idcard_images_data.idcard_back||""),e["province"]=this.province_id,e["city"]=this.city_id,e["county"]=this.county_id,e["id"]=this.params.id||0;var s=this.address_data||{};e["is_default"]=s.is_default||0;var l=s.lng||0,o=s.lat||0;null!=(this.user_location||null)&&(l=this.user_location.lng||0,o=this.user_location.lat||0),e["lng"]=l,e["lat"]=o,n.globalData.fields_check(e,i)&&(this.setData({form_submit_disabled_status:!0}),uni.showLoading({title:"处理中..."}),uni.request({url:n.globalData.get_request_url("save","useraddress"),method:"POST",data:e,dataType:"json",success:function(a){uni.hideLoading(),0==a.data.code?(n.globalData.showToast(a.data.msg,"success"),setTimeout((function(){uni.navigateBack()}),1e3)):(t.setData({form_submit_disabled_status:!1}),n.globalData.is_login_check(a.data)?n.globalData.showToast(a.data.msg):n.globalData.showToast("提交失败，请重试！"))},fail:function(){t.setData({form_submit_disabled_status:!1}),uni.hideLoading(),n.globalData.showToast("服务器请求出错")}}))}}};t.default=o},"2e96":function(a,t,e){var i=e("24fb");t=i(!1),t.push([a.i,"/*\r\n* 三级联动\r\n*/.select-address[data-v-8ab1b478]{box-sizing:border-box;height:%?70?%;line-height:%?70?%;padding:0 %?10?%}.select-address .section[data-v-8ab1b478]{width:33.33%;box-sizing:border-box}.select-address .section[data-v-8ab1b478]:not(:first-child){padding:0 %?5?%}\r\n/**\r\n * 地址信息\r\n */.default-checkbox uni-image[data-v-8ab1b478]{width:%?35?%;height:%?35?%!important}.address-value[data-v-8ab1b478]{padding-right:%?110?%}.map-icon[data-v-8ab1b478]{bottom:0;right:0;width:%?90?%;height:%?80?%;line-height:%?80?%}.auto-discern[data-v-8ab1b478]{bottom:%?20?%;right:%?20?%;z-index:2}.auto-discern uni-button[data-v-8ab1b478]{line-height:inherit;padding:%?5?% %?20?%!important}\r\n/*\r\n* 身份信息\r\n*/.idcard-container[data-v-8ab1b478]{background:#e6e6e6}.idcard-container .form-upload-data .item uni-image[data-v-8ab1b478]{width:%?256?%;height:%?170?%;border:1px dashed #c2c2c2}",""]),a.exports=t},"3fd0":function(a,t,e){"use strict";e.d(t,"b",(function(){return s})),e.d(t,"c",(function(){return n})),e.d(t,"a",(function(){return i}));var i={uniIcons:e("c262").default},s=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("v-uni-view",{staticClass:"page-bottom-fixed"},[e("v-uni-form",{staticClass:"form-container",on:{submit:function(t){arguments[0]=t=a.$handleEvent(t),a.form_submit.apply(void 0,arguments)}}},[e("v-uni-view",{staticClass:"padding-main oh"},[e("v-uni-view",{staticClass:"form-gorup oh"},[e("v-uni-view",{staticClass:"form-gorup-item-left"},[e("v-uni-view",{staticClass:"form-gorup-title"},[a._v("联系人"),e("v-uni-text",{staticClass:"form-group-tips-must"},[a._v("*")])],1),e("v-uni-input",{staticClass:"cr-base",attrs:{type:"text",name:"name",value:a.address_data.name||"",maxlength:"16","placeholder-class":"cr-grey",placeholder:"联系人2~16个字符"}})],1),e("v-uni-view",{staticClass:"form-gorup-item-right"},[e("v-uni-view",{staticClass:"form-gorup-title"},[a._v("联系电话"),e("v-uni-text",{staticClass:"form-group-tips-must"},[a._v("*")])],1),e("v-uni-input",{staticClass:"cr-base",attrs:{type:"text",name:"tel",value:a.address_data.tel||"",maxlength:"30","placeholder-class":"cr-grey",placeholder:"座机或手机"}})],1)],1),e("v-uni-view",{staticClass:"form-gorup"},[0==a.is_user_address_forbid_choice_region?[e("v-uni-view",{staticClass:"br-b padding-bottom-xs margin-bottom-lg"},[e("v-uni-view",{staticClass:"form-gorup-title"},[a._v("省市区"),e("v-uni-text",{staticClass:"form-group-tips-must"},[a._v("必选")])],1),e("v-uni-view",{staticClass:"select-address oh"},[e("v-uni-view",{staticClass:"section fl"},[e("v-uni-picker",{attrs:{name:"province",value:a.province_value,range:a.province_list,"range-key":"name"},on:{change:function(t){arguments[0]=t=a.$handleEvent(t),a.select_province_event.apply(void 0,arguments)}}},[e("v-uni-view",{class:"name "+(null==a.province_value?"cr-grey":"cr-base")},[a._v(a._s(null==(a.province_list[a.province_value]||null)?a.default_province:a.province_list[a.province_value]["name"]))])],1)],1),e("v-uni-view",{staticClass:"section fl"},[null!=(a.province_id||null)?e("v-uni-picker",{attrs:{name:"city",value:a.city_value,range:a.city_list,"range-key":"name"},on:{change:function(t){arguments[0]=t=a.$handleEvent(t),a.select_city_event.apply(void 0,arguments)}}},[e("v-uni-view",{class:"name "+(null==a.city_value?"cr-grey":"cr-base")},[a._v(a._s(null==(a.city_list[a.city_value]||null)?a.default_city:a.city_list[a.city_value]["name"]))])],1):e("v-uni-text",{staticClass:"cr-grey",attrs:{"data-value":"请先选择省份"},on:{click:function(t){arguments[0]=t=a.$handleEvent(t),a.region_select_error_event.apply(void 0,arguments)}}},[a._v("请先选择省份")])],1),e("v-uni-view",{staticClass:"section fl"},[null!=(a.city_id||null)?e("v-uni-picker",{attrs:{name:"county",value:a.county_value,range:a.county_list,"range-key":"name"},on:{change:function(t){arguments[0]=t=a.$handleEvent(t),a.select_county_event.apply(void 0,arguments)}}},[e("v-uni-view",{class:"name "+(null==a.county_value?"cr-grey":"cr-base")},[a._v(a._s(null==(a.county_list[a.county_value]||null)?a.default_county:a.county_list[a.county_value]["name"]))])],1):e("v-uni-text",{staticClass:"cr-grey",attrs:{"data-value":"请先选择城市"},on:{click:function(t){arguments[0]=t=a.$handleEvent(t),a.region_select_error_event.apply(void 0,arguments)}}},[a._v("请先选择城市")])],1)],1)],1)]:[null!=(a.address_data.province_name||null)?e("v-uni-view",{staticClass:"br-b padding-bottom-lg margin-bottom-lg"},[a._v(a._s(a.address_data.province_name)+a._s(a.address_data.city_name||"")+a._s(a.address_data.county_name||""))]):a._e()],e("v-uni-view",{staticClass:"pr"},[e("v-uni-view",{staticClass:"form-gorup-title"},[a._v("详细地址"),e("v-uni-text",{staticClass:"form-group-tips-must"},[a._v("*")]),1==a.home_user_address_map_status?e("v-uni-text",{staticClass:"fr form-group-tips"},[a._v("地理位置")]):a._e()],1),e("v-uni-input",{class:"cr-base bs-bb "+(1==a.home_user_address_map_status?"address-value":""),attrs:{type:"text",name:"address",value:a.address_data.address||"",maxlength:"80","placeholder-class":"cr-grey",placeholder:"详细地址1~80个字符"}}),1==a.home_user_address_map_status?e("v-uni-view",{staticClass:"map-icon pa cp tc",on:{click:function(t){arguments[0]=t=a.$handleEvent(t),a.choose_location_event.apply(void 0,arguments)}}},[e("uni-icons",{attrs:{type:"location",size:"20",color:"#666"}})],1):a._e()],1),e("v-uni-view",{staticClass:"br-t padding-top-lg margin-top-xs pr"},[e("v-uni-view",{staticClass:"form-gorup-title"},[a._v("别名")]),e("v-uni-input",{staticClass:"cr-base",attrs:{type:"text",name:"alias",value:a.address_data.alias||"",maxlength:"16","placeholder-class":"cr-grey",placeholder:"别名最多16个字符"}})],1)],2),1==a.is_user_address_discern?e("v-uni-view",{staticClass:"form-gorup pr br-main-pair"},[e("v-uni-textarea",{staticClass:"margin-0",attrs:{placeholder:"粘贴整段地址，自动拆分姓名、电话及地址","placeholder-class":"cr-grey"},on:{input:function(t){arguments[0]=t=a.$handleEvent(t),a.address_discern_value_event.apply(void 0,arguments)}}}),e("v-uni-cover-view",{staticClass:"auto-discern pa"},[e("v-uni-button",{staticClass:"round bg-main-pair cr-white br-main-pair",attrs:{type:"default",size:"mini"},on:{click:function(t){arguments[0]=t=a.$handleEvent(t),a.address_discern_submit_event.apply(void 0,arguments)}}},[a._v("识别")])],1)],1):a._e(),1==a.home_user_address_idcard_status?e("v-uni-view",{staticClass:"idcard-container padding-horizontal-main padding-top-main border-radius-main oh"},[e("v-uni-view",{staticClass:"form-gorup"},[e("v-uni-view",{staticClass:"form-gorup-title"},[a._v("身份证姓名"),e("v-uni-text",{staticClass:"form-group-tips-must"},[a._v("*")]),e("v-uni-text",{staticClass:"form-group-tips"},[a._v("请务必与上传的身份证件姓名保持一致")])],1),e("v-uni-input",{staticClass:"cr-base",attrs:{type:"text",name:"idcard_name",value:a.address_data.idcard_name||"",maxlength:"16","placeholder-class":"cr-grey",placeholder:"身份证姓名格式 2~16 个字符之间"}})],1),e("v-uni-view",{staticClass:"form-gorup"},[e("v-uni-view",{staticClass:"form-gorup-title"},[a._v("身份证号码"),e("v-uni-text",{staticClass:"form-group-tips-must"},[a._v("*")]),e("v-uni-text",{staticClass:"form-group-tips"},[a._v("请务必与上传的身份证件号码保持一致")])],1),e("v-uni-input",{staticClass:"cr-base",attrs:{type:"idcard",name:"idcard_number",value:a.address_data.idcard_number||"",maxlength:"18","placeholder-class":"cr-grey",placeholder:"身份证号码格式最多18个字符"}})],1),e("v-uni-view",{staticClass:"form-gorup bg-white form-container-upload oh"},[e("v-uni-view",{staticClass:"form-gorup-title"},[a._v("身份证照片"),e("v-uni-text",{staticClass:"form-group-tips-must"},[a._v("必传")]),e("v-uni-text",{staticClass:"form-group-tips"},[a._v("请使用身份证原件拍摄，图片要清晰")])],1),e("v-uni-view",{staticClass:"form-upload-data"},[e("v-uni-view",{staticClass:"item fl"},[null!=(a.idcard_images_data.idcard_front||null)?e("v-uni-text",{staticClass:"delete-icon",attrs:{"data-value":"idcard_front"},on:{click:function(t){arguments[0]=t=a.$handleEvent(t),a.upload_delete_event.apply(void 0,arguments)}}},[a._v("x")]):a._e(),e("v-uni-image",{attrs:{src:null!=(a.idcard_images_data.idcard_front||null)?a.idcard_images_data.idcard_front:a.common_static_url+"idcard-front.jpg","data-value":"idcard_front",mode:"aspectFill"},on:{click:function(t){arguments[0]=t=a.$handleEvent(t),a.file_upload_event.apply(void 0,arguments)}}})],1),e("v-uni-view",{staticClass:"item fl"},[null!=(a.idcard_images_data.idcard_back||null)?e("v-uni-text",{staticClass:"delete-icon",attrs:{"data-value":"idcard_back"},on:{click:function(t){arguments[0]=t=a.$handleEvent(t),a.upload_delete_event.apply(void 0,arguments)}}},[a._v("x")]):a._e(),e("v-uni-image",{attrs:{src:null!=(a.idcard_images_data.idcard_back||null)?a.idcard_images_data.idcard_back:a.common_static_url+"idcard-back.jpg","data-value":"idcard_back",mode:"aspectFill"},on:{click:function(t){arguments[0]=t=a.$handleEvent(t),a.file_upload_event.apply(void 0,arguments)}}})],1)],1)],1)],1):a._e(),e("v-uni-view",{staticClass:"default-checkbox margin-top-xl",on:{click:function(t){arguments[0]=t=a.$handleEvent(t),a.default_ads_change_event.apply(void 0,arguments)}}},[e("v-uni-image",{staticClass:"va-m",attrs:{src:a.common_static_url+"select"+(1==(a.address_data.is_default||0)?"-active":"")+"-icon.png",mode:"widthFix"}}),e("v-uni-text",{staticClass:"va-m margin-left-sm"},[a._v("设为默认地址")])],1),e("v-uni-view",{staticClass:"bottom-fixed padding-main"},[e("v-uni-button",{staticClass:"bg-main br-main cr-white round text-size",attrs:{type:"default","form-type":"submit","hover-class":"none",disabled:a.form_submit_disabled_status}},[a._v("保存")])],1)],1)],1)],1)},n=[]},8496:function(a,t,e){"use strict";e.r(t);var i=e("3fd0"),s=e("a670");for(var n in s)["default"].indexOf(n)<0&&function(a){e.d(t,a,(function(){return s[a]}))}(n);e("a72f");var l=e("f0c5"),o=Object(l["a"])(s["default"],i["b"],i["c"],!1,null,"8ab1b478",null,!1,i["a"],void 0);t["default"]=o.exports},a670:function(a,t,e){"use strict";e.r(t);var i=e("27c4"),s=e.n(i);for(var n in i)["default"].indexOf(n)<0&&function(a){e.d(t,a,(function(){return i[a]}))}(n);t["default"]=s.a},a72f:function(a,t,e){"use strict";var i=e("aa51"),s=e.n(i);s.a},aa51:function(a,t,e){var i=e("2e96");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[a.i,i,""]]),i.locals&&(a.exports=i.locals);var s=e("4f06").default;s("073e8a85",i,!0,{sourceMap:!1,shadowMode:!1})}}]);