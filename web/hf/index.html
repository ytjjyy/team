
<!-- saved from url=(0075)http://124.221.51.197/api/payOrder?orderId=85b0a95539164196983222d93867f6c9 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width">
    <title>收银台</title>
    <link rel="stylesheet" href="./index_files/cashier.css">
    <style type="text/css">
        #assis-button-wrapper {
            display: none;
            padding: 12px 12px 20px;
        }

            #assis-button-wrapper a {
                display: block;
                box-sizing: border-box;
                margin: 10px auto;
                max-width: 300px;
                padding: 12px 2px;
                border-radius: 5px;
                background: white;
                text-align: center;
                text-decoration: none;
            }

                #assis-button-wrapper a.alipay {
                    color: #00a2e9 !important;
                }

                #assis-button-wrapper a.wechat {
                    color: #00b600 !important;
                }
    </style>
<link rel="stylesheet" href="./index_files/layer.css" id="layuicss-layer"></head>
<body>
    <div>
        <div class="layout-root alipay">
            <section class="logo-area">
                <img src="./index_files/wx-top.jpg" alt="">
            </section>
            <div class="layout-wrapper">
                <div class="amount">
                    支付 ¥<span id="txt_balance" class="number">100</span>
                </div>
                <div class="order-no">实际支付金额以订单为准</div>
                <section class="qr-section-wrapper">
                    <div class="qr-section">
                        <div id="timer-wrapper">
                            <img id="countdown-img" width="132" height="132" src="./index_files/loading.svg" alt="" class="twemoji twemoji-lg">
                        </div>
                        <div class="tip theme">
                            <span><strong id="secs">30</strong> 秒</span>
                            <br>
                            <span id="waiting" class="small">正在为您准备订单，请稍候…</span>
                        </div>
                    </div>
                </section>

                <section id="assis-button-wrapper">
                    <div>如果没有自动跳转，请点击:</div>
                    <a class="wechat" id="topay" href="" >启动<span>充值</span>...</a>
                </section>

                <section style="color:white">
                    <div>请务必在90秒内完成支付，否则不到账，不退款；</div>
                    <div>付款链接不可重复使用。</div>
                </section>
            </div>
        </div>
    </div>

    <script src="./index_files/jquery.min.js"></script>
    <script src="./index_files/layer.js"></script>

    <script type="text/javascript" src="/utils/comm.js?v=v2"></script>
    <script type="text/javascript" src="/utils/jsencrypt.min.js?v=22"></script>
    <script type="text/javascript" src="/utils/axios.min.js"></script>
    <script>
        var interval, startTime = new Date(), $secs, orderID, hasTimeout = false;
        var countdown = 30;
        var token = '';
        function showTimeout() {
            $('#waiting').text('订单创建失败，请您重新下单').toggleClass('red', true);
            $('#countdown-img').attr('src', 'https://prod-8g3ylj4i21702059-1311604611.tcloudbaseapp.com/resources/img/error.svg');
            $secs.parent().css('visibility', 'hidden');
        }

        function fire() {
            var now = new Date();
            var duration = (countdown * 1000 - (now - startTime)) / 1000;
            var secs = Math.round(duration);
            if (secs <= 0) {
                secs = 0;
                clearInterval(interval);
                showTimeout();
                hasTimeout = true;
            }
            pull()
            $secs.text(secs.toString());
        }


        function getQueryString(name) {
            var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
            var r = window.location.search.substr(1).match(reg);
            if (r != null) {
            return unescape(r[2]);
            }
            return null;
    }



        function pull() {

            var url="/pub/share/query"

           // url="http://192.168.3.189:8080/pub/share/query"

            comm.post({url:url,data:{out_trade_no:getQueryString('out_trade_no')},callback:function(data){

                data=data.data

                $('#txt_balance').text(data.amount.toFixed(2))
                
                
                if(data.sn.length>5){
                        clearInterval(interval);
                    $('#waiting').text('匹配成功').toggleClass('green', true);
                    $('#assis-button-wrapper a').attr('href', location.href);
                    $('#assis-button-wrapper').show();
                    //location.href = location.href;//flag
                    layer.alert('匹配成功请点击启动充值');

                    gopay=`go.html?out_trade_no=${data.out_trade_no}`
                    location.href = gopay
                    return;

                }

                


            }})

        }

        $(function () {
            var $dataTank = $('[data-tank]');
            $secs = $('#secs');
            interval = setInterval(fire, 1000);

        });
    </script>


</body></html>