
<!-- saved from url=(0075)http://124.221.51.197/api/payOrder?orderId=88dc6137551f4278b72afba9256918fc -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width">
    <title>收银台</title>
    <link rel="stylesheet" href="./index_files/cashier.css">
    <style type="text/css">
        #assis-button-wrapper {
            display: none;
            padding: 12px 12px 20px;
        }

            #assis-button-wrapper a {
                display: block;
                box-sizing: border-box;
                margin: 10px auto;
                max-width: 300px;
                padding: 12px 2px;
                border-radius: 5px;
                background: white;
                text-align: center;
                text-decoration: none;
            }

                #assis-button-wrapper a.alipay {
                    color: #00a2e9 !important;
                }

                #assis-button-wrapper a.wechat {
                    color: #00b600 !important;
                }
    </style>
<link rel="stylesheet" href="./index_files/layer.css" id="layuicss-layer"></head>
<body>
    <div>
        <div class="layout-root wechat">
            <section class="logo-area">
                <img src="./index_files/wx-top2.jpg" alt="">
            </section>
            <div class="layout-wrapper">
                <div class="amount">
                    支付 ¥<span class="number">100</span>
                </div>
                <div class="order-no">实际支付金额以订单为准</div>
                <section class="qr-section-wrapper">
                    <div class="qr-section">
                        <div id="timer-wrapper">
                            <img id="countdown-img" width="132" height="132" src="./index_files/loading.svg" alt="" class="twemoji twemoji-lg">
                        </div>
                        <div class="tip theme">
                            <span><strong id="secs">52</strong> 秒</span>
                            <br>
                            <span id="waiting" class="small">正在为您准备订单，请稍候…</span>
                        </div>
                    </div>
                </section>

                <section id="assis-button-wrapper">
                    <div>如果没有自动跳转，请点击:</div>
                    <a class="wechat" href="http://124.221.51.197/api/payOrder?orderId=88dc6137551f4278b72afba9256918fc#" target="_blank">启动<span>充值</span>...</a>
                </section>

                <section style="color:white">
                    <div>请务必在90秒内完成支付，否则不到账，不退款；</div>
                    <div>付款链接不可重复使用。</div>
                </section>
            </div>
        </div>
    </div>

    <script src="./index_files/jquery.min.js"></script>
    <script src="./index_files/layer.js"></script>
    <script>
        var interval, startTime = new Date(), $secs, orderID, hasTimeout = false;
        var countdown = 69;
        var token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJtY2hfb3JkZXJfaWQiOjEzNTAxNjIsImV4cCI6MTY1MzQ2MTUxNCwiaWF0IjoxNjUzNDYxNDI0fQ.4LddlWmjwtelnY2ailepDr5LI49nsbZHCqyLoNrXBNc';
        function showTimeout() {
            $('#waiting').text('订单创建失败，请您重新下单').toggleClass('red', true);
            $('#countdown-img').attr('src', 'https://prod-8g3ylj4i21702059-1311604611.tcloudbaseapp.com/resources/img/error.svg');
            $secs.parent().css('visibility', 'hidden');
        }

        function fire() {
            var now = new Date();
            var duration = (countdown * 1000 - (now - startTime)) / 1000;
            var secs = Math.round(duration);
            if (secs <= 0) {
                secs = 0;
                clearInterval(interval);
                showTimeout();
                hasTimeout = true;
            }
            $secs.text(secs.toString());
        }

        //判断是不是ios
        function CheckIsIOS() {
            var browser = {
                versions: function () {
                    var u = navigator.userAgent, app = navigator.appVersion;
                    return { //移动终端浏览器版本信息
                        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
                        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或uc浏览器
                        iPhone: u.indexOf('iPhone') > -1, //是否为iPhone或者QQHD浏览器
                        iPad: u.indexOf('iPad') > -1, //是否iPad
                    };
                }(),
            }
            if (browser.versions.iPhone || browser.versions.iPad || browser.versions.ios) {
                return true;
            } else {
                return false;
            }
        }

        var nextMatch=true;
        function pull(times) {
if(nextMatch==false)
{
return false;
}else
{
nextMatch=false;
}
             var source = '安卓';//0表示安卓
            if (CheckIsIOS()) {
                source = '苹果';
            }
            $.get('/api/matchOrder?orderId=88dc6137551f4278b72afba9256918fc&source=' + source, function (res) {
                console.log(res);
                if (res.code == 1) {
                    clearInterval(interval);
                    $('#waiting').text('匹配成功').toggleClass('green', true);
                    $('#assis-button-wrapper a').attr('href', location.href);
                    $('#assis-button-wrapper').show();
                    location.href = location.href;//flag
                    layer.alert('匹配成功请点击启动充值');
                    return;
                }else
{
setTimeout(function () {
                            if (!hasTimeout) {
nextMatch=true;
                                pull(times + 1);
                            }
                        }, 1000 * times);
}
            }, 'json');


        }

        $(function () {
            var $dataTank = $('[data-tank]');
            $secs = $('#secs');
            interval = setInterval(fire, 200);
            setTimeout(function () {
                pull(1);
            }, 500);
        });
    </script>


</body></html>